export const mockApiResponse = {
  forecasts: [
    {
      pv_power_rooftop: 0.184,
      period_end: "2024-08-29T21:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.292,
      period_end: "2024-08-29T22:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.389,
      period_end: "2024-08-29T22:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.474,
      period_end: "2024-08-29T23:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.546,
      period_end: "2024-08-29T23:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.605,
      period_end: "2024-08-30T00:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.65,
      period_end: "2024-08-30T00:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.682,
      period_end: "2024-08-30T01:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.701,
      period_end: "2024-08-30T01:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.708,
      period_end: "2024-08-30T02:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.704,
      period_end: "2024-08-30T02:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.688,
      period_end: "2024-08-30T03:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.66,
      period_end: "2024-08-30T03:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.62,
      period_end: "2024-08-30T04:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.569,
      period_end: "2024-08-30T04:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.504,
      period_end: "2024-08-30T05:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.407,
      period_end: "2024-08-30T05:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.311,
      period_end: "2024-08-30T06:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.213,
      period_end: "2024-08-30T06:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.11,
      period_end: "2024-08-30T07:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.018,
      period_end: "2024-08-30T07:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T08:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T08:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T09:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T09:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T10:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T10:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T11:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T11:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T12:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T12:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T13:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T13:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T14:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T14:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T15:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T15:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T16:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T16:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T17:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T17:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T18:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T18:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T19:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T19:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T20:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0,
      period_end: "2024-08-30T20:30:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.071,
      period_end: "2024-08-30T21:00:00.0000000Z",
      period: "PT30M",
    },
    {
      pv_power_rooftop: 0.194,
      period_end: "2024-08-30T21:30:00.0000000Z",
      period: "PT30M",
    },
  ],
};

function calculateTotalEnergy(dataPoints) {
  const secondsPerDay = 24 * 60 * 60;

  // Sort the data points by timestamp
  dataPoints?.sort((a, b) => a.timestamp - b.timestamp);

  let totalEnergy = 0;
  let lastTimestamp = null;

  for (const { timestamp, power } of dataPoints) {
    if (lastTimestamp !== null) {
      const timeDiffSeconds = Math.floor((timestamp - lastTimestamp) / 1000);
      totalEnergy += (power * timeDiffSeconds) / 3600; // Convert to kWh
    }
    lastTimestamp = timestamp;
  }

  // Scale to represent a full year
  const daysInYear = 365.25; // Account for leap years
  const hoursInYear = daysInYear * 24;
  const scalingFactor = hoursInYear / ((dataPoints.length * 30) / 60); // Assuming 30-minute intervals

  return totalEnergy * scalingFactor;
}

function parseApiResponse(apiResponse) {
  return apiResponse.forecasts?.map((forecast) => ({
    timestamp: new Date(forecast.period_end),
    power: forecast.pv_power_rooftop,
  }));
}


export function calculateAnnualPowerOutput(forecastData) {
  const parsedData = parseApiResponse(forecastData);
  const annualEnergyProduction = calculateTotalEnergy(parsedData);

  console.log(`Estimated annual power output: ${annualEnergyProduction.toFixed(2)} kWh`);
  return annualEnergyProduction;
}